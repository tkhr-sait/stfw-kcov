var data = {lines:[
{"lineNum":"    1","line":"#!/bin/bash"},
{"lineNum":"    2","line":"#set -eux"},
{"lineNum":"    3","line":"#==================================================================================================="},
{"lineNum":"    4","line":"# stfw generate共通ユーティリティ"},
{"lineNum":"    5","line":"#"},
{"lineNum":"    6","line":"# 前提"},
{"lineNum":"    7","line":"#   ・システム設定を事前に読み込んでいること"},
{"lineNum":"    8","line":"#"},
{"lineNum":"    9","line":"# 定義リスト"},
{"lineNum":"   10","line":"#   stfw.digdag.local_run"},
{"lineNum":"   11","line":"#   stfw.digdag.push"},
{"lineNum":"   12","line":"#   stfw.digdag.start"},
{"lineNum":"   13","line":"#   stfw.digdag.get_attempt_id"},
{"lineNum":"   14","line":"#   stfw.digdag.show_start_info"},
{"lineNum":"   15","line":"#   stfw.digdag.log_follow"},
{"lineNum":"   16","line":"#   stfw.digdag.server.start"},
{"lineNum":"   17","line":"#   stfw.digdag.server.stop"},
{"lineNum":"   18","line":"#   stfw.digdag.server.is_running"},
{"lineNum":"   19","line":"#"},
{"lineNum":"   20","line":"#==================================================================================================="},
{"lineNum":"   21","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   22","line":"# 定数"},
{"lineNum":"   23","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   24","line":"readonly STFW__FILENAME_START_INFO=\"start.info\"","class":"lineCov","hits":"20","order":"1228","possible_hits":"0",},
{"lineNum":"   25","line":""},
{"lineNum":"   26","line":""},
{"lineNum":"   27","line":"#--------------------------------------------------------------------------------------------------"},
{"lineNum":"   28","line":"# 共通関数読込み"},
{"lineNum":"   29","line":"#--------------------------------------------------------------------------------------------------"},
{"lineNum":"   30","line":"# stfw共通ユーティリティ"},
{"lineNum":"   31","line":". \"${DIR_BIN_LIB}/stfw_utils\"","class":"lineCov","hits":"10","order":"1229","possible_hits":"0",},
{"lineNum":"   32","line":""},
{"lineNum":"   33","line":""},
{"lineNum":"   34","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   35","line":"# dig実行 localモード"},
{"lineNum":"   36","line":"#"},
{"lineNum":"   37","line":"# 概要"},
{"lineNum":"   38","line":"#   指定のdigファイルを digdag local モードで実行します。"},
{"lineNum":"   39","line":"#"},
{"lineNum":"   40","line":"# 引数"},
{"lineNum":"   41","line":"#   1: digファイルパス"},
{"lineNum":"   42","line":"#"},
{"lineNum":"   43","line":"# 出力"},
{"lineNum":"   44","line":"#   環境変数"},
{"lineNum":"   45","line":"#     なし"},
{"lineNum":"   46","line":"#   標準出力"},
{"lineNum":"   47","line":"#     なし"},
{"lineNum":"   48","line":"#   ファイル"},
{"lineNum":"   49","line":"#     なし"},
{"lineNum":"   50","line":"#"},
{"lineNum":"   51","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   52","line":"function stfw.digdag.local_run() {"},
{"lineNum":"   53","line":"  log.func_start_trace \"$@\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   54","line":""},
{"lineNum":"   55","line":"  local _dig_file_path=\"$1\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   56","line":"  local _dig_dir=$(dirname \"${_dig_file_path}\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   57","line":"  local _dig_file_name=$(basename \"${_dig_file_path}\")","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   58","line":""},
{"lineNum":"   59","line":"  local _retcode=${EXITCODE_SUCCESS}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   60","line":""},
{"lineNum":"   61","line":"  log.trace \"cd \\\"${_dig_dir}\\\"\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   62","line":"  cd \"${_dig_dir}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   63","line":""},
{"lineNum":"   64","line":"  local _cmd=( \"${PATH_DIGDAG}\" run \"${_dig_file_name}\" --rerun )","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   65","line":"  log.debug \"${_cmd[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   66","line":"  \"${_cmd[@]}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   67","line":"  _retcode=$?","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   68","line":""},
{"lineNum":"   69","line":"  log.trace \"cd -\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   70","line":"  cd - >/dev/null 2>&1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   71","line":""},
{"lineNum":"   72","line":"  log.func_end_trace ${_retcode}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   73","line":"  return ${_retcode}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"   74","line":"}"},
{"lineNum":"   75","line":""},
{"lineNum":"   76","line":""},
{"lineNum":"   77","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   78","line":"# digdag push"},
{"lineNum":"   79","line":"#"},
{"lineNum":"   80","line":"# 概要"},
{"lineNum":"   81","line":"#   指定のdigdagプロジェクトディレクトリをdigdag serverにpushします。"},
{"lineNum":"   82","line":"#"},
{"lineNum":"   83","line":"# 引数"},
{"lineNum":"   84","line":"#   1:  digdagプロジェクトディレクトリ"},
{"lineNum":"   85","line":"#   2:  digdagプロジェクト名"},
{"lineNum":"   86","line":"#   3~: digdagプロジェクト リビジョン名引数リスト"},
{"lineNum":"   87","line":"#"},
{"lineNum":"   88","line":"# 出力"},
{"lineNum":"   89","line":"#   環境変数"},
{"lineNum":"   90","line":"#     なし"},
{"lineNum":"   91","line":"#   標準出力"},
{"lineNum":"   92","line":"#     なし"},
{"lineNum":"   93","line":"#   ファイル"},
{"lineNum":"   94","line":"#     なし"},
{"lineNum":"   95","line":"#"},
{"lineNum":"   96","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"   97","line":"function stfw.digdag.push() {"},
{"lineNum":"   98","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"2","order":"1425","possible_hits":"0",},
{"lineNum":"   99","line":""},
{"lineNum":"  100","line":"  local _proj_dir=\"$1\"","class":"lineCov","hits":"2","order":"1426","possible_hits":"0",},
{"lineNum":"  101","line":"  local _proj_name=\"$2\"","class":"lineCov","hits":"2","order":"1427","possible_hits":"0",},
{"lineNum":"  102","line":"  shift 2","class":"lineCov","hits":"2","order":"1428","possible_hits":"0",},
{"lineNum":"  103","line":"  local _rev_args=\"$*\"","class":"lineCov","hits":"2","order":"1429","possible_hits":"0",},
{"lineNum":"  104","line":""},
{"lineNum":"  105","line":"  local _retcode=${EXITCODE_SUCCESS}","class":"lineCov","hits":"2","order":"1430","possible_hits":"0",},
{"lineNum":"  106","line":""},
{"lineNum":"  107","line":"  log.trace \"cd \\\"${_proj_dir}\\\"\"","class":"lineCov","hits":"2","order":"1431","possible_hits":"0",},
{"lineNum":"  108","line":"  cd \"${_proj_dir}\"","class":"lineCov","hits":"2","order":"1432","possible_hits":"0",},
{"lineNum":"  109","line":""},
{"lineNum":"  110","line":"  local _cmd=(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  111","line":"    \"${PATH_DIGDAG}\" push \"${_proj_name}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  112","line":"      --revision \"${_rev_args}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  113","line":"      --endpoint \"localhost:${stfw_server_port}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  114","line":"  )","class":"lineCov","hits":"4","order":"1433","possible_hits":"0",},
{"lineNum":"  115","line":"  log.debug \"${_cmd[@]}\"","class":"lineCov","hits":"2","order":"1434","possible_hits":"0",},
{"lineNum":"  116","line":"  \"${_cmd[@]}\"","class":"lineCov","hits":"2","order":"1435","possible_hits":"0",},
{"lineNum":"  117","line":"  _retcode=$?","class":"lineCov","hits":"2","order":"1446","possible_hits":"0",},
{"lineNum":"  118","line":""},
{"lineNum":"  119","line":"  log.trace \"cd -\"","class":"lineCov","hits":"2","order":"1447","possible_hits":"0",},
{"lineNum":"  120","line":"  cd - >/dev/null 2>&1","class":"lineCov","hits":"2","order":"1448","possible_hits":"0",},
{"lineNum":"  121","line":""},
{"lineNum":"  122","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"2","order":"1449","possible_hits":"0",},
{"lineNum":"  123","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1450","possible_hits":"0",},
{"lineNum":"  124","line":"}"},
{"lineNum":"  125","line":""},
{"lineNum":"  126","line":""},
{"lineNum":"  127","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  128","line":"# dig実行 clientモード"},
{"lineNum":"  129","line":"#"},
{"lineNum":"  130","line":"# 概要"},
{"lineNum":"  131","line":"#   digdag serverにpushしたプロジェクトのdigを実行します。"},
{"lineNum":"  132","line":"#"},
{"lineNum":"  133","line":"# 引数"},
{"lineNum":"  134","line":"#   1: digdagプロジェクトディレクトリ"},
{"lineNum":"  135","line":"#   2: digdagプロジェクト名"},
{"lineNum":"  136","line":"#   3: dig名"},
{"lineNum":"  137","line":"#"},
{"lineNum":"  138","line":"# 出力"},
{"lineNum":"  139","line":"#   環境変数"},
{"lineNum":"  140","line":"#     なし"},
{"lineNum":"  141","line":"#   標準出力"},
{"lineNum":"  142","line":"#     なし"},
{"lineNum":"  143","line":"#   ファイル"},
{"lineNum":"  144","line":"#     digdagプロジェクトディレクトリ/start.info"},
{"lineNum":"  145","line":"#"},
{"lineNum":"  146","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  147","line":"function stfw.digdag.start() {"},
{"lineNum":"  148","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"2","order":"1505","possible_hits":"0",},
{"lineNum":"  149","line":""},
{"lineNum":"  150","line":"  local _proj_dir=\"$1\"","class":"lineCov","hits":"2","order":"1506","possible_hits":"0",},
{"lineNum":"  151","line":"  local _proj_name=\"$2\"","class":"lineCov","hits":"2","order":"1507","possible_hits":"0",},
{"lineNum":"  152","line":"  local _dig_name=\"$3\"","class":"lineCov","hits":"2","order":"1508","possible_hits":"0",},
{"lineNum":"  153","line":""},
{"lineNum":"  154","line":"  local _retcode=${EXITCODE_SUCCESS}","class":"lineCov","hits":"2","order":"1509","possible_hits":"0",},
{"lineNum":"  155","line":""},
{"lineNum":"  156","line":"  local _cmd=(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  157","line":"    \"${PATH_DIGDAG}\" start \"${_proj_name}\" \"${_dig_name}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  158","line":"      --session now","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  159","line":"      --endpoint \"localhost:${stfw_server_port}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  160","line":"  )","class":"lineCov","hits":"4","order":"1510","possible_hits":"0",},
{"lineNum":"  161","line":"  log.debug \"${_cmd[@]}\"","class":"lineCov","hits":"2","order":"1511","possible_hits":"0",},
{"lineNum":"  162","line":"  \"${_cmd[@]}\"                                                                                2>&1 |","class":"lineCov","hits":"2","order":"1512","possible_hits":"0",},
{"lineNum":"  163","line":"  tee \"${_proj_dir}/${STFW__FILENAME_START_INFO}\"","class":"lineCov","hits":"2","order":"1513","possible_hits":"0",},
{"lineNum":"  164","line":"  _retcode=${PIPESTATUS[0]}","class":"lineCov","hits":"2","order":"1514","possible_hits":"0",},
{"lineNum":"  165","line":""},
{"lineNum":"  166","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"2","order":"1515","possible_hits":"0",},
{"lineNum":"  167","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1516","possible_hits":"0",},
{"lineNum":"  168","line":"}"},
{"lineNum":"  169","line":""},
{"lineNum":"  170","line":""},
{"lineNum":"  171","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  172","line":"# attempt id取得"},
{"lineNum":"  173","line":"#"},
{"lineNum":"  174","line":"# 概要"},
{"lineNum":"  175","line":"#   stfw.digdag.startで実行したdigのattempt idを取得します。"},
{"lineNum":"  176","line":"#"},
{"lineNum":"  177","line":"# 引数"},
{"lineNum":"  178","line":"#   1: digdagプロジェクトディレクトリ"},
{"lineNum":"  179","line":"#"},
{"lineNum":"  180","line":"# 出力"},
{"lineNum":"  181","line":"#   環境変数"},
{"lineNum":"  182","line":"#     なし"},
{"lineNum":"  183","line":"#   標準出力"},
{"lineNum":"  184","line":"#     attempt id"},
{"lineNum":"  185","line":"#   ファイル"},
{"lineNum":"  186","line":"#     なし"},
{"lineNum":"  187","line":"#"},
{"lineNum":"  188","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  189","line":"function stfw.digdag.get_attempt_id() {"},
{"lineNum":"  190","line":"  private.stfw.digdag.get_start_info \"$1\" \"attempt id\"","class":"lineCov","hits":"4","order":"1537","possible_hits":"0",},
{"lineNum":"  191","line":"}"},
{"lineNum":"  192","line":""},
{"lineNum":"  193","line":""},
{"lineNum":"  194","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  195","line":"# dig実行情報の表示"},
{"lineNum":"  196","line":"#"},
{"lineNum":"  197","line":"# 概要"},
{"lineNum":"  198","line":"#   stfw.digdag.startで実行したdigの実行情報を表示します。"},
{"lineNum":"  199","line":"#"},
{"lineNum":"  200","line":"# 引数"},
{"lineNum":"  201","line":"#   1: digdagプロジェクトディレクトリ"},
{"lineNum":"  202","line":"#"},
{"lineNum":"  203","line":"# 出力"},
{"lineNum":"  204","line":"#   環境変数"},
{"lineNum":"  205","line":"#     なし"},
{"lineNum":"  206","line":"#   標準出力"},
{"lineNum":"  207","line":"#     実行情報"},
{"lineNum":"  208","line":"#   ファイル"},
{"lineNum":"  209","line":"#     なし"},
{"lineNum":"  210","line":"#"},
{"lineNum":"  211","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  212","line":"function stfw.digdag.show_start_info() {"},
{"lineNum":"  213","line":"  local _digdag_proj_dir=\"$1\"","class":"lineCov","hits":"2","order":"1522","possible_hits":"0",},
{"lineNum":"  214","line":""},
{"lineNum":"  215","line":"  local _project=$(private.stfw.digdag.get_start_info \"${_digdag_proj_dir}\" \"project\")","class":"lineCov","hits":"4","order":"1523","possible_hits":"0",},
{"lineNum":"  216","line":"  local _workflow=$(private.stfw.digdag.get_start_info \"${_digdag_proj_dir}\" \"workflow\")","class":"lineCov","hits":"4","order":"1534","possible_hits":"0",},
{"lineNum":"  217","line":"  local _session_id=$(private.stfw.digdag.get_start_info \"${_digdag_proj_dir}\" \"session id\")","class":"lineCov","hits":"4","order":"1535","possible_hits":"0",},
{"lineNum":"  218","line":"  local _attempt_id=$(stfw.digdag.get_attempt_id \"${_digdag_proj_dir}\")","class":"lineCov","hits":"4","order":"1536","possible_hits":"0",},
{"lineNum":"  219","line":""},
{"lineNum":"  220","line":"  echo \"project    : ${_project}\"","class":"lineCov","hits":"2","order":"1538","possible_hits":"0",},
{"lineNum":"  221","line":"  echo \"workflow   : ${_workflow}\"","class":"lineCov","hits":"2","order":"1539","possible_hits":"0",},
{"lineNum":"  222","line":"  echo \"session_id : ${_session_id}\"","class":"lineCov","hits":"2","order":"1540","possible_hits":"0",},
{"lineNum":"  223","line":"  echo \"attempt_id : ${_attempt_id}\"","class":"lineCov","hits":"2","order":"1541","possible_hits":"0",},
{"lineNum":"  224","line":"}"},
{"lineNum":"  225","line":""},
{"lineNum":"  226","line":""},
{"lineNum":"  227","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  228","line":"# dig実行ログの表示"},
{"lineNum":"  229","line":"#"},
{"lineNum":"  230","line":"# 概要"},
{"lineNum":"  231","line":"#   stfw.digdag.startで実行したdigの実行ログを表示します。"},
{"lineNum":"  232","line":"#"},
{"lineNum":"  233","line":"# 引数"},
{"lineNum":"  234","line":"#   1: digdagプロジェクトディレクトリ"},
{"lineNum":"  235","line":"#   2: attempt id"},
{"lineNum":"  236","line":"#"},
{"lineNum":"  237","line":"# 出力"},
{"lineNum":"  238","line":"#   環境変数"},
{"lineNum":"  239","line":"#     なし"},
{"lineNum":"  240","line":"#   標準出力"},
{"lineNum":"  241","line":"#     実行ログ"},
{"lineNum":"  242","line":"#   ファイル"},
{"lineNum":"  243","line":"#     なし"},
{"lineNum":"  244","line":"#"},
{"lineNum":"  245","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  246","line":"function stfw.digdag.log_follow() {"},
{"lineNum":"  247","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"2","order":"1557","possible_hits":"0",},
{"lineNum":"  248","line":"  local _digdag_proj_dir=\"$1\"","class":"lineCov","hits":"2","order":"1558","possible_hits":"0",},
{"lineNum":"  249","line":"  local _attempt_id=\"$2\"","class":"lineCov","hits":"2","order":"1559","possible_hits":"0",},
{"lineNum":"  250","line":""},
{"lineNum":"  251","line":"  echo \"\"","class":"lineCov","hits":"2","order":"1560","possible_hits":"0",},
{"lineNum":"  252","line":"  echo \"---------- attempt_id:${_attempt_id} ----------\"","class":"lineCov","hits":"2","order":"1561","possible_hits":"0",},
{"lineNum":"  253","line":""},
{"lineNum":"  254","line":"  cd \"${_digdag_proj_dir}\"","class":"lineCov","hits":"2","order":"1562","possible_hits":"0",},
{"lineNum":"  255","line":"  \"${PATH_DIGDAG}\" log ${_attempt_id} --follow","class":"lineCov","hits":"2","order":"1563","possible_hits":"0",},
{"lineNum":"  256","line":"  _retcode=$?","class":"lineCov","hits":"2","order":"1564","possible_hits":"0",},
{"lineNum":"  257","line":"  cd - >/dev/null 2>&1","class":"lineCov","hits":"2","order":"1565","possible_hits":"0",},
{"lineNum":"  258","line":""},
{"lineNum":"  259","line":"  echo \"---------- attempt_id:${_attempt_id} ----------\"","class":"lineCov","hits":"2","order":"1566","possible_hits":"0",},
{"lineNum":"  260","line":"  echo \"\"","class":"lineCov","hits":"2","order":"1567","possible_hits":"0",},
{"lineNum":"  261","line":""},
{"lineNum":"  262","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"2","order":"1568","possible_hits":"0",},
{"lineNum":"  263","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1569","possible_hits":"0",},
{"lineNum":"  264","line":"}"},
{"lineNum":"  265","line":""},
{"lineNum":"  266","line":""},
{"lineNum":"  267","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  268","line":"# digdag server 起動"},
{"lineNum":"  269","line":"#"},
{"lineNum":"  270","line":"# 概要"},
{"lineNum":"  271","line":"#   digdag serverを起動します。"},
{"lineNum":"  272","line":"#"},
{"lineNum":"  273","line":"# 引数"},
{"lineNum":"  274","line":"#   なし"},
{"lineNum":"  275","line":"#"},
{"lineNum":"  276","line":"# 出力"},
{"lineNum":"  277","line":"#   環境変数"},
{"lineNum":"  278","line":"#     なし"},
{"lineNum":"  279","line":"#   標準出力"},
{"lineNum":"  280","line":"#     なし"},
{"lineNum":"  281","line":"#   ファイル"},
{"lineNum":"  282","line":"#     なし"},
{"lineNum":"  283","line":"#"},
{"lineNum":"  284","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  285","line":"function stfw.digdag.server.start() {"},
{"lineNum":"  286","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"2","order":"1244","possible_hits":"0",},
{"lineNum":"  287","line":""},
{"lineNum":"  288","line":"  # ディレクトリ作成"},
{"lineNum":"  289","line":"  if [ ! -d \"${STFW_PROJ_DIR_DATA}\" ]; then","class":"lineCov","hits":"2","order":"1245","possible_hits":"0",},
{"lineNum":"  290","line":"    mkdir -p \"${STFW_PROJ_DIR_DATA}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  291","line":"  fi"},
{"lineNum":"  292","line":""},
{"lineNum":"  293","line":"  log.trace \"printenv:\"","class":"lineCov","hits":"2","order":"1246","possible_hits":"0",},
{"lineNum":"  294","line":"  log.add_indent","class":"lineCov","hits":"2","order":"1247","possible_hits":"0",},
{"lineNum":"  295","line":"  log.trace \"$(printenv | sort)\"","class":"lineCov","hits":"6","order":"1248","possible_hits":"0",},
{"lineNum":"  296","line":"  log.remove_indent","class":"lineCov","hits":"2","order":"1249","possible_hits":"0",},
{"lineNum":"  297","line":""},
{"lineNum":"  298","line":"  local _parsed_log_level=$(stfw.parse_log_level \"${LOGLEVEL}\")","class":"lineCov","hits":"4","order":"1250","possible_hits":"0",},
{"lineNum":"  299","line":""},
{"lineNum":"  300","line":"  # digdag server 起動"},
{"lineNum":"  301","line":"  # shellcheck disable=SC2206"},
{"lineNum":"  302","line":"  local _cmd=(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  303","line":"    \"${PATH_DIGDAG}\" server","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  304","line":"      --bind \"${stfw_server_bind}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  305","line":"      --port \"${stfw_server_port}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  306","line":"      ${stfw_server_db_mode}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  307","line":"      --max-task-threads \"${stfw_server_max_task_threads}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  308","line":"      --log-level \"${_parsed_log_level}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  309","line":"      --log \"${PATH_LOG}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  310","line":"      --task-log \"${STFW_PROJ_DIR_DATA}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  311","line":"      --access-log \"${STFW_PROJ_DIR_DATA}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  312","line":"  )","class":"lineCov","hits":"4","order":"1253","possible_hits":"0",},
{"lineNum":"  313","line":"  log.info \"${_cmd[@]}\"","class":"lineCov","hits":"2","order":"1254","possible_hits":"0",},
{"lineNum":"  314","line":"  ( nohup \"${_cmd[@]}\" >>\"${PATH_LOG}\" 2>&1 < /dev/null ) &","class":"lineCov","hits":"2","order":"1257","possible_hits":"0",},
{"lineNum":"  315","line":"  local _pid=$!","class":"lineCov","hits":"2","order":"1255","possible_hits":"0",},
{"lineNum":"  316","line":""},
{"lineNum":"  317","line":"  log.trace \"echo \\\"${_pid}\\\" >\\\"${PATH_PROJ_PID}\\\"\"","class":"lineCov","hits":"2","order":"1256","possible_hits":"0",},
{"lineNum":"  318","line":"  echo \"${_pid}\" >\"${PATH_PROJ_PID}\"","class":"lineCov","hits":"2","order":"1258","possible_hits":"0",},
{"lineNum":"  319","line":""},
{"lineNum":"  320","line":"  # 起動を待つ"},
{"lineNum":"  321","line":"  private.stfw.digdag.server.wait_response","class":"lineCov","hits":"2","order":"1259","possible_hits":"0",},
{"lineNum":"  322","line":"  _retcode=$?","class":"lineCov","hits":"2","order":"1278","possible_hits":"0",},
{"lineNum":"  323","line":""},
{"lineNum":"  324","line":"  if [[ ${_retcode} -ne ${EXITCODE_SUCCESS} ]]; then","class":"lineCov","hits":"2","order":"1279","possible_hits":"0",},
{"lineNum":"  325","line":"    log.error \"failed to start stfw.server process.\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  326","line":"    return ${_retcode}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  327","line":"  fi"},
{"lineNum":"  328","line":"  log.info \"start stfw.server process. PID=${_pid}\"","class":"lineCov","hits":"2","order":"1280","possible_hits":"0",},
{"lineNum":"  329","line":""},
{"lineNum":"  330","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"2","order":"1281","possible_hits":"0",},
{"lineNum":"  331","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1282","possible_hits":"0",},
{"lineNum":"  332","line":"}"},
{"lineNum":"  333","line":""},
{"lineNum":"  334","line":""},
{"lineNum":"  335","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  336","line":"# digdag server 停止"},
{"lineNum":"  337","line":"#"},
{"lineNum":"  338","line":"# 概要"},
{"lineNum":"  339","line":"#   digdag serverを停止します。"},
{"lineNum":"  340","line":"#"},
{"lineNum":"  341","line":"# 引数"},
{"lineNum":"  342","line":"#   なし"},
{"lineNum":"  343","line":"#"},
{"lineNum":"  344","line":"# 出力"},
{"lineNum":"  345","line":"#   環境変数"},
{"lineNum":"  346","line":"#     なし"},
{"lineNum":"  347","line":"#   標準出力"},
{"lineNum":"  348","line":"#     なし"},
{"lineNum":"  349","line":"#   ファイル"},
{"lineNum":"  350","line":"#     なし"},
{"lineNum":"  351","line":"#"},
{"lineNum":"  352","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  353","line":"function stfw.digdag.server.stop() {"},
{"lineNum":"  354","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"2","order":"1580","possible_hits":"0",},
{"lineNum":"  355","line":"  local _retcode=${EXITCODE_SUCCESS}","class":"lineCov","hits":"2","order":"1581","possible_hits":"0",},
{"lineNum":"  356","line":""},
{"lineNum":"  357","line":"  # Process Kill"},
{"lineNum":"  358","line":"  local _pid=$(cat ${PATH_PROJ_PID})","class":"lineCov","hits":"4","order":"1582","possible_hits":"0",},
{"lineNum":"  359","line":"  if [[ \"$(pgrep -F ${PATH_PROJ_PID})x\" != \"x\" ]]; then","class":"lineCov","hits":"4","order":"1583","possible_hits":"0",},
{"lineNum":"  360","line":"    kill -s SIGTERM ${_pid}","class":"lineCov","hits":"2","order":"1584","possible_hits":"0",},
{"lineNum":"  361","line":"    _retcode=$?","class":"lineCov","hits":"2","order":"1585","possible_hits":"0",},
{"lineNum":"  362","line":"  fi"},
{"lineNum":"  363","line":""},
{"lineNum":"  364","line":"  # PIDファイルを削除"},
{"lineNum":"  365","line":"  rm -f ${PATH_PROJ_PID}","class":"lineCov","hits":"2","order":"1586","possible_hits":"0",},
{"lineNum":"  366","line":"  log.info \"stop stfw.server process. PID=${_pid}\"","class":"lineCov","hits":"2","order":"1587","possible_hits":"0",},
{"lineNum":"  367","line":""},
{"lineNum":"  368","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"2","order":"1588","possible_hits":"0",},
{"lineNum":"  369","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1589","possible_hits":"0",},
{"lineNum":"  370","line":"}"},
{"lineNum":"  371","line":""},
{"lineNum":"  372","line":""},
{"lineNum":"  373","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  374","line":"# digdag server 起動済みチェック"},
{"lineNum":"  375","line":"#"},
{"lineNum":"  376","line":"# 概要"},
{"lineNum":"  377","line":"#   digdag serverが起動済みか確認します。"},
{"lineNum":"  378","line":"#"},
{"lineNum":"  379","line":"# 引数"},
{"lineNum":"  380","line":"#   なし"},
{"lineNum":"  381","line":"#"},
{"lineNum":"  382","line":"# 出力"},
{"lineNum":"  383","line":"#   環境変数"},
{"lineNum":"  384","line":"#     なし"},
{"lineNum":"  385","line":"#   標準出力"},
{"lineNum":"  386","line":"#     true : 起動済み"},
{"lineNum":"  387","line":"#     false: その他の場合"},
{"lineNum":"  388","line":"#   ファイル"},
{"lineNum":"  389","line":"#     なし"},
{"lineNum":"  390","line":"#"},
{"lineNum":"  391","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  392","line":"function stfw.digdag.server.is_running() {"},
{"lineNum":"  393","line":"  log.func_start_trace \"$@\"","class":"lineCov","hits":"6","order":"1296","possible_hits":"0",},
{"lineNum":"  394","line":""},
{"lineNum":"  395","line":"  # PIDファイルの存在確認"},
{"lineNum":"  396","line":"  if [[ ! -f \"${PATH_PROJ_PID}\" ]]; then","class":"lineCov","hits":"6","order":"1297","possible_hits":"0",},
{"lineNum":"  397","line":"    log.trace \"${PATH_PROJ_PID} is not exist.\"","class":"lineCov","hits":"2","order":"1599","possible_hits":"0",},
{"lineNum":"  398","line":"    echo \"false\"","class":"lineCov","hits":"2","order":"1600","possible_hits":"0",},
{"lineNum":"  399","line":"    return ${EXITCODE_SUCCESS}","class":"lineCov","hits":"2","order":"1601","possible_hits":"0",},
{"lineNum":"  400","line":"  fi"},
{"lineNum":"  401","line":""},
{"lineNum":"  402","line":"  # プロセスの存在確認"},
{"lineNum":"  403","line":"  local _pid=$(cat \"${PATH_PROJ_PID}\")","class":"lineCov","hits":"8","order":"1298","possible_hits":"0",},
{"lineNum":"  404","line":"  if [[ \"$(pgrep -F ${PATH_PROJ_PID})x\" = \"x\" ]]; then","class":"lineCov","hits":"8","order":"1299","possible_hits":"0",},
{"lineNum":"  405","line":"    # PIDファイルがあって、プロセスが存在しない場合、PIDファイルを削除して、停止中扱い"},
{"lineNum":"  406","line":"    log.trace \"${_pid} is not running.\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  407","line":"    rm -f ${PATH_PROJ_PID}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  408","line":"    echo \"false\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  409","line":"    return ${EXITCODE_SUCCESS}","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  410","line":"  fi"},
{"lineNum":"  411","line":""},
{"lineNum":"  412","line":"  # リクエストを送って起動チェック"},
{"lineNum":"  413","line":"  private.stfw.digdag.server.is_running","class":"lineCov","hits":"4","order":"1300","possible_hits":"0",},
{"lineNum":"  414","line":""},
{"lineNum":"  415","line":"  log.func_end_trace ${EXITCODE_SUCCESS}","class":"lineCov","hits":"4","order":"1301","possible_hits":"0",},
{"lineNum":"  416","line":"  return ${EXITCODE_SUCCESS}","class":"lineCov","hits":"4","order":"1302","possible_hits":"0",},
{"lineNum":"  417","line":"}"},
{"lineNum":"  418","line":""},
{"lineNum":"  419","line":""},
{"lineNum":"  420","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  421","line":"# private dig起動情報の値取得"},
{"lineNum":"  422","line":"#"},
{"lineNum":"  423","line":"# 概要"},
{"lineNum":"  424","line":"#   dig起動情報から指定キーの値を表示します。"},
{"lineNum":"  425","line":"#"},
{"lineNum":"  426","line":"# 引数"},
{"lineNum":"  427","line":"#   1: 起動情報のキー"},
{"lineNum":"  428","line":"#"},
{"lineNum":"  429","line":"# 出力"},
{"lineNum":"  430","line":"#   環境変数"},
{"lineNum":"  431","line":"#     なし"},
{"lineNum":"  432","line":"#   標準出力"},
{"lineNum":"  433","line":"#     指定キーの値"},
{"lineNum":"  434","line":"#   ファイル"},
{"lineNum":"  435","line":"#     なし"},
{"lineNum":"  436","line":"#"},
{"lineNum":"  437","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  438","line":"function private.stfw.digdag.get_start_info() {"},
{"lineNum":"  439","line":"  local _digdag_proj_dir=\"$1\"","class":"lineCov","hits":"10","order":"1524","possible_hits":"0",},
{"lineNum":"  440","line":"  local _key=\"$2\"","class":"lineCov","hits":"10","order":"1525","possible_hits":"0",},
{"lineNum":"  441","line":"  local _start_info=\"${_digdag_proj_dir}/${STFW__FILENAME_START_INFO}\"","class":"lineCov","hits":"10","order":"1526","possible_hits":"0",},
{"lineNum":"  442","line":""},
{"lineNum":"  443","line":"  grep \"${_key}:\" < \"${_start_info}\"                                                               | # start.infoから、keyでgrep","class":"lineCov","hits":"10","order":"1527","possible_hits":"0",},
{"lineNum":"  444","line":"  cut -d \':\' -f 2                                                                                  | # : 区切りの 2フィールド目","class":"lineCov","hits":"10","order":"1528","possible_hits":"0",},
{"lineNum":"  445","line":"  _trim","class":"lineCov","hits":"10","order":"1529","possible_hits":"0",},
{"lineNum":"  446","line":"}"},
{"lineNum":"  447","line":""},
{"lineNum":"  448","line":""},
{"lineNum":"  449","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  450","line":"# private digdag serverの起動待機"},
{"lineNum":"  451","line":"#"},
{"lineNum":"  452","line":"# 概要"},
{"lineNum":"  453","line":"#   digdag serverからレスポンスが返却されるまで待機します。"},
{"lineNum":"  454","line":"#   timeout 10秒"},
{"lineNum":"  455","line":"#"},
{"lineNum":"  456","line":"# 引数"},
{"lineNum":"  457","line":"#   なし"},
{"lineNum":"  458","line":"#"},
{"lineNum":"  459","line":"# 出力"},
{"lineNum":"  460","line":"#   環境変数"},
{"lineNum":"  461","line":"#     なし"},
{"lineNum":"  462","line":"#   標準出力"},
{"lineNum":"  463","line":"#     なし"},
{"lineNum":"  464","line":"#   ファイル"},
{"lineNum":"  465","line":"#     なし"},
{"lineNum":"  466","line":"#"},
{"lineNum":"  467","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  468","line":"function private.stfw.digdag.server.wait_response() {"},
{"lineNum":"  469","line":"  log.func_start_trace","class":"lineCov","hits":"2","order":"1260","possible_hits":"0",},
{"lineNum":"  470","line":"  local _RETRY_COUNT=10","class":"lineCov","hits":"2","order":"1261","possible_hits":"0",},
{"lineNum":"  471","line":""},
{"lineNum":"  472","line":"  local _path_tmp_retry=\"${STFW_PROJ_DIR_DATA}/${FUNCNAME[0]}_retry_$$\"","class":"lineCov","hits":"2","order":"1262","possible_hits":"0",},
{"lineNum":"  473","line":"  echo ${_RETRY_COUNT} >\"${_path_tmp_retry}\"","class":"lineCov","hits":"2","order":"1263","possible_hits":"0",},
{"lineNum":"  474","line":""},
{"lineNum":"  475","line":"  local _retcode=${EXITCODE_SUCCESS}","class":"lineCov","hits":"2","order":"1264","possible_hits":"0",},
{"lineNum":"  476","line":""},
{"lineNum":"  477","line":"  local _is_success=$(","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  478","line":"    while :; do","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  479","line":"      local _retry_count=$(cat ${_path_tmp_retry})","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  480","line":"      if [[ \"${_retry_count}\" = \"0\" ]]; then break; fi","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  481","line":"      _retry_count=$((_retry_count - 1))","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  482","line":"      echo ${_retry_count} >\"${_path_tmp_retry}\"","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  483","line":""},
{"lineNum":"  484","line":"      local _is_running=$(private.stfw.digdag.server.is_running)","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  485","line":"      if [[ \"${_is_running}\" = \"true\" ]]; then echo \"true\"; break; fi","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  486","line":"      sleep 1","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  487","line":"    done"},
{"lineNum":"  488","line":"  )","class":"lineCov","hits":"2","order":"1276","possible_hits":"0",},
{"lineNum":"  489","line":""},
{"lineNum":"  490","line":"  if [[ \"${_is_success}\" != \"true\" ]]; then _retcode=${EXITCODE_ERROR}; fi","class":"lineCov","hits":"14","order":"1265","possible_hits":"0",},
{"lineNum":"  491","line":"  rm -f \"${_path_tmp_retry}\"","class":"lineCov","hits":"8","order":"1266","possible_hits":"0",},
{"lineNum":"  492","line":""},
{"lineNum":"  493","line":"  log.func_end_trace ${_retcode}","class":"lineCov","hits":"8","order":"1267","possible_hits":"0",},
{"lineNum":"  494","line":"  return ${_retcode}","class":"lineCov","hits":"2","order":"1277","possible_hits":"0",},
{"lineNum":"  495","line":"}"},
{"lineNum":"  496","line":""},
{"lineNum":"  497","line":""},
{"lineNum":"  498","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  499","line":"# private digdag serverの起動チェック"},
{"lineNum":"  500","line":"#"},
{"lineNum":"  501","line":"# 概要"},
{"lineNum":"  502","line":"#   digdag serverからレスポンスが返却されるか確認します。"},
{"lineNum":"  503","line":"#"},
{"lineNum":"  504","line":"# 引数"},
{"lineNum":"  505","line":"#   なし"},
{"lineNum":"  506","line":"#"},
{"lineNum":"  507","line":"# 出力"},
{"lineNum":"  508","line":"#   環境変数"},
{"lineNum":"  509","line":"#     なし"},
{"lineNum":"  510","line":"#   標準出力"},
{"lineNum":"  511","line":"#     true : レスポンスが返却された場合"},
{"lineNum":"  512","line":"#     false: その他の場合"},
{"lineNum":"  513","line":"#   ファイル"},
{"lineNum":"  514","line":"#     なし"},
{"lineNum":"  515","line":"#"},
{"lineNum":"  516","line":"#---------------------------------------------------------------------------------------------------"},
{"lineNum":"  517","line":"function private.stfw.digdag.server.is_running() {"},
{"lineNum":"  518","line":"  log.func_start_trace","class":"lineCov","hits":"10","order":"1268","possible_hits":"0",},
{"lineNum":"  519","line":"  local _URL_HEALTHCHECK=\"http://localhost:${stfw_server_port}/api/projects\"","class":"lineCov","hits":"10","order":"1269","possible_hits":"0",},
{"lineNum":"  520","line":""},
{"lineNum":"  521","line":"  local _cur_status=$(                                                                             \\","class":"lineNoCov","hits":"0","possible_hits":"0",},
{"lineNum":"  522","line":"    curl                                                                                           \\"},
{"lineNum":"  523","line":"      --silent                                                                                     \\"},
{"lineNum":"  524","line":"      --request GET                                                                                \\"},
{"lineNum":"  525","line":"      --write-out \'%{http_code}\'                                                                   \\"},
{"lineNum":"  526","line":"      --output /dev/null                                                                           \\"},
{"lineNum":"  527","line":"      ${_URL_HEALTHCHECK}                                                                          \\"},
{"lineNum":"  528","line":"    2>/dev/null                                                                                    \\"},
{"lineNum":"  529","line":"  )"},
{"lineNum":"  530","line":""},
{"lineNum":"  531","line":"  log.trace \"response code: ${_cur_status}\"","class":"lineCov","hits":"10","order":"1270","possible_hits":"0",},
{"lineNum":"  532","line":"  if [[ \"$(echo ${_cur_status} | cut -c 1)\" = \"2\" ]]; then","class":"lineCov","hits":"30","order":"1271","possible_hits":"0",},
{"lineNum":"  533","line":"    echo \"true\"","class":"lineCov","hits":"6","order":"1274","possible_hits":"0",},
{"lineNum":"  534","line":"    return","class":"lineCov","hits":"6","order":"1275","possible_hits":"0",},
{"lineNum":"  535","line":"  fi"},
{"lineNum":"  536","line":""},
{"lineNum":"  537","line":"  echo \"false\"","class":"lineCov","hits":"4","order":"1272","possible_hits":"0",},
{"lineNum":"  538","line":"  log.func_end_trace ${EXITCODE_SUCCESS}","class":"lineCov","hits":"4","order":"1273","possible_hits":"0",},
{"lineNum":"  539","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "integration_test.sh", "date" : "2018-02-01 18:54:43", "instrumented" : 166, "covered" : 116,};
var merged_data = [];
